<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Task Pulse Smart V8.7 â€” Orange Pulse Hybrid</title>

<link rel="preload" as="image" href="taskpulse-splash-hex.jpeg" />
<link rel="manifest" href="manifest.json" />
<link rel="icon" href="icon-192.png" sizes="192x192" />
<meta name="theme-color" content="#120d08" />

<style>

/* ========= ORANGE-PULSE HYBRID THEME ========= */
:root{
  --bg:#0d0b08;           
  --card:#1b140e;         
  --ink:#f7f3e8;          
  --muted:#b9a894;        
  --line:#30251b;         
  --pill:#271c12;         
  --radius:16px;
  --tap:50px;
  --pad:14px;

  --amber:#ff9d3b;
  --amber-soft:#ffb766;
  --amber-dark:#2a1b0d;
  --amber-glow:rgba(255,150,50,0.45);
}

@media(max-width:480px){
  :root{
    --pad:12px;
    --radius:14px;
    --tap:56px;
  }
}

*{
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
  margin:0;
  padding:0;
}

html,body{height:100%}

body{
  background:#0d0b08;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--ink);
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:12px;
}

/* ========= SHELL ========= */
.shell{
  width:100%;
  max-width:900px;
  background:#14100c;
  border-radius:18px;
  padding:16px;
  border:1px solid #31261a;
  box-shadow:0 20px 50px rgba(0,0,0,.65);
  animation:fadeIn .4s ease-out;
}

.wrap{
  max-width:820px;
  margin:0 auto;
  padding:4px var(--pad) calc(40px + env(safe-area-inset-bottom));
}

/* ========= ANIMATIONS ========= */
@keyframes fadeIn{
  from{opacity:0;transform:translateY(6px);}
  to{opacity:1;transform:translateY(0);}
}

@keyframes glowPulse{
  0%{box-shadow:0 0 0 rgba(255,150,50,0.25);}
  50%{box-shadow:0 0 14px rgba(255,180,80,0.45);}
  100%{box-shadow:0 0 0 rgba(255,150,50,0.25);}
}

/* ========= HEADER ========= */
.hero-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.logo-pill{
  background:radial-gradient(circle at 30% 20%, var(--amber-soft), var(--amber-dark));
  width:44px;
  height:44px;
  border-radius:999px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:700;
  font-size:18px;
  color:white;
  box-shadow:0 0 12px var(--amber-glow);
}

.brand-title{font-size:18px;font-weight:700;}
.brand-sub{font-size:11px;color:var(--muted);}

.badge{
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  background:var(--pill);
  border:1px solid #4d3928;
}
.badge.good{
  color:#ffe7c5;
  border-color:#ffb766;
}

/* ========= TABS ========= */
.tabs{
  position:sticky;
  top:0;
  background:#14100cee;
  backdrop-filter:blur(6px);
  padding:6px 0 4px;
  z-index:50;
}

.tabbar{
  display:flex;
  gap:8px;
  overflow:auto;
}

.tabbar button{
  flex:1;
  min-width:110px;
  padding:7px 10px;
  border-radius:999px;
  background:#2a1b0d;
  color:#e6d8c8;
  border:1px solid #3e2a1c;
  cursor:pointer;
  transition:all .25s ease;
}

.tabbar button.active{
  background:linear-gradient(135deg, var(--amber), var(--amber-soft));
  color:#201407;
  font-weight:600;
  box-shadow:0 0 14px var(--amber-glow);
}

.tabpage{display:none;}
.tabpage.active{display:block;animation:fadeIn .3s ease-out;}

/* ========= CARDS ========= */
.card{
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--line);
  padding:12px 14px;
  margin:10px 0;
  box-shadow:0 6px 24px rgba(0,0,0,.35);
}

/* ========= TASK INPUT + BUTTONS ========= */
input,select,button{
  border-radius:999px;
  border:1px solid var(--line);
  background:#0f0b08;
  color:var(--ink);
  padding:7px 11px;
  min-height:var(--tap);
}

button.primary{
  background:linear-gradient(135deg, var(--amber), var(--amber-soft));
  color:#1c120a;
  font-weight:600;
  border:none;
  cursor:pointer;
  box-shadow:0 0 10px var(--amber-glow);
}

.btn-ghost{
  background:#1a130d;
  border:1px solid #3c2a1c;
  color:var(--muted);
}

/* ========= SPLASH ========= */
#splash{
  position:fixed;
  inset:0;
  background:#0c0907;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#splash::before{
  content:"";
  position:absolute;
  inset:0;
  background:url('taskpulse-splash-hex.jpeg') center/cover no-repeat;
  opacity:.9;
  filter:saturate(120%) brightness(1.05);
  animation:zoomfade 1.9s ease forwards;
}

#splash .label{
  position:relative;
  text-align:center;
  color:#fff5e3;
  text-shadow:0 2px 12px rgba(0,0,0,.6);
  animation:fadeIn .8s ease both .2s;
}

#splash h2{
  margin:0;
  font-size:32px;
  letter-spacing:.5px;
}

#splash .sub{font-size:13px;margin-top:6px;opacity:.85;}
#splash .foot{position:absolute;bottom:18px;width:100%;text-align:center;font-size:12px;}

.hide-splash #splash{display:none;}

@keyframes zoomfade{
  0%{opacity:0;transform:scale(1.08)}
  15%{opacity:1}
  100%{opacity:0;transform:scale(1)}
}

/* ========= MEDS BUTTONS ========= */
.meds-btn{
  flex:1 1 150px;
  min-width:0;
  border-radius:14px;
  padding:12px 14px;
  background:#120d08;
  border:1px solid #3a291e;
  text-align:left;
  display:flex;
  flex-direction:column;
  color:#f3e8db;
  transition:all .25s ease;
}

.meds-btn:hover{
  border-color:#ffb766;
}

/* Taken state */
.meds-btn-taken{
  background:linear-gradient(90deg, #ffb766 0%, #ff9d3b 45%, #2a1b0d 100%);
  border-color:#ffcf8d;
  color:#201207;
  animation:glowPulse 2.5s infinite;
}

.meds-btn-title{
  font-size:14px;
  font-weight:600;
}

.meds-btn-sub{
  font-size:12px;
  color:#e0ccb6;
}

.meds-countdown{
  margin-top:6px;
  font-size:13px;
  color:#ffb766;
}

.meds-banner{
  margin:8px 0;
  padding:10px 14px;
  background:#2c1e14;
  border:1px solid #ffb766;
  border-radius:12px;
  color:#ffe4c5;
  font-weight:600;
}

/* ========= WEEK STRIP ========= */
.week-strip{
  display:flex;
  gap:6px;
  margin-top:10px;
}

.week-strip div{
  flex:1;
  height:12px;
  border-radius:6px;
  background:#2a1b0d;
  border:1px solid #3c2a1c;
}

.week-strip .done{
  background:linear-gradient(135deg,#ffb766,#ff9d3b);
  border-color:#ffcf8d;
  box-shadow:0 0 8px var(--amber-glow);
}

</style>
</head>

<body>
<div id="splash">
  <div class="label">
    <h2>Task Pulse Smart</h2>
    <div class="sub">V8.7 â€” Orange Pulse Hybrid</div>
    <div class="foot">Powered by D Gounder</div>
  </div>
</div>

<!-- MAIN APP SHELL -->
<div class="shell">
  <div class="wrap">

    <!-- HEADER -->
    <header class="hero-header">
      <div class="brand">
        <div class="logo-pill">TP</div>
        <div>
          <div class="brand-title">Task Pulse Smart</div>
          <div class="brand-sub">Daily Focus Advisor Â· V8.7</div>
        </div>
      </div>

      <div class="top-right">
        <div id="syncState" class="badge">Local-only</div>
        <div id="tpLastBackup" class="muted" style="font-size:11px">Last backup: none</div>
      </div>
    </header>

    <!-- KPI PILL (Tasks Summary) -->
    <div class="kpi-pill card" id="kpiRow">
      <span id="kpiText">0 / 0 done (0%) Â· Quality 0%</span>
      <span id="todayLabel" class="muted">â€”</span>
    </div>

    <!-- Meds Banner -->
    <div id="medsReminder" class="meds-banner" style="display:none;"></div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tabbar">
        <button id="btnTabTasks" class="active" onclick="showTab('tasks')">Tasks</button>
        <button id="btnTabHistory" onclick="showTab('history')">History</button>
        <button id="btnTabSettings" onclick="showTab('settings')">Settings</button>
      </div>
    </div>

    <!-- ============================= -->
    <!--        TAB: TASKS             -->
    <!-- ============================= -->
    <div id="tab-tasks" class="tabpage active">

      <!-- ========== MEDICATION CARD ========== -->
      <section class="card meds-card" id="medsCard">

        <div class="meds-head">
          <div class="meds-head-title">Medication â€” Today</div>
          <div class="meds-head-tag">TLE Routine</div>
        </div>

        <div class="meds-row">
          <button id="btnMedsDay"
                  class="meds-btn"
                  onclick="toggleMeds('day')"
                  title="Mark Morning Dose">
            <!-- JS populates -->
          </button>

          <button id="btnMedsNight"
                  class="meds-btn"
                  onclick="toggleMeds('night')"
                  title="Mark Night Dose">
            <!-- JS populates -->
          </button>
        </div>

        <div id="medsCountdown" class="meds-countdown"></div>
        <div id="medsMeta" class="muted" style="margin-top:6px;font-size:12px;"></div>

        <div id="medsWeekStrip" class="week-strip" style="margin-top:10px;"></div>
      </section>

      <!-- ========== TASK ENTRY CARD ========== -->
      <section class="card">
        <h3 style="margin:0 0 8px">Today's Tasks</h3>

        <div class="row" style="margin-bottom:8px">
          <input id="taskInput" type="text" placeholder="Add taskâ€¦" list="taskSuggestions" autocomplete="off" />
          <datalist id="taskSuggestions"></datalist>

          <select id="prioSelect">
            <option value="low">low</option>
            <option value="med">med</option>
            <option value="high">high</option>
          </select>

          <button class="primary" onclick="addTask()">Add</button>
        </div>

        <div class="row">
          <button class="btn-ghost" onclick="clearCompleted()">Clear completed</button>
          <button class="btn-ghost" onclick="manualCarryOver()">Carry incomplete â†’ tomorrow</button>
        </div>
      </section>

      <!-- ========== TASK LIST CARD ========== -->
      <section class="card">

        <div class="row" style="justify-content:space-between">
          <div>
            <div class="muted">Viewing</div>
            <div id="viewingLabel" style="font-weight:600">â€”</div>
          </div>

          <div class="nav">
            <button class="btn-ghost" onclick="shiftDay(-1)">â—€</button>
            <button class="btn-ghost" onclick="shiftDay(+1)">â–¶</button>
          </div>
        </div>

        <ul id="taskList" class="list" style="margin-top:8px"></ul>

        <div class="sum">
          <div id="doneSummary">0 / 0 tasks done (0%)</div>
          <div id="qualitySummary">Quality 0%</div>
        </div>
      </section>

      <!-- Automatic carry banner -->
      <div id="carryWarn" class="meds-banner" style="display:none;font-weight:500"></div>

    </div> <!-- END TASK TAB -->

    <!-- ============================= -->
    <!--        TAB: HISTORY            -->
    <!-- ============================= -->
    <div id="tab-history" class="tabpage">

      <section class="card">
        <h3 style="margin:0 0 8px">History</h3>

        <div class="row" style="gap:6px;margin-bottom:6px">
          <input id="histSearch" type="text" placeholder="Search text or YYYY-MM-DDâ€¦" oninput="renderHistory()" />
          <select id="histSpan" onchange="renderHistory()">
            <option value="7">Last 7 days</option>
            <option value="14">Last 14 days</option>
            <option value="30" selected>Last 30 days</option>
            <option value="90">Last 90 days</option>
            <option value="all">All</option>
          </select>
        </div>

        <div id="histList"></div>
      </section>

    </div>

    <!-- ============================= -->
    <!--        TAB: SETTINGS          -->
    <!-- ============================= -->
    <div id="tab-settings" class="tabpage">

      <!-- Sync -->
      <section class="card">
        <h3 style="margin:0 0 8px">Sync</h3>

        <div class="row" style="margin-bottom:10px">
          <input id="syncCode" placeholder="Sync code" style="flex:1 1 260px" />
          <button class="btn-ghost" onclick="copySyncCode()">Copy</button>
          <button class="btn-ghost" onclick="newSyncCode()">New code</button>
          <button class="primary" onclick="saveSyncCode()">Save</button>
        </div>

        <div class="muted" style="font-size:12px;">
          Open this site on your second device and enter the same code.
        </div>
      </section>

      <!-- Backup -->
      <section class="card">
        <h3 style="margin:0 0 8px">Backup &amp; Restore</h3>

        <div class="row" style="align-items:center">
          <button id="btnBackup" class="primary" onclick="tpDownloadBackup()">â­³ Download Backup</button>
          <input id="tpRestoreFile" type="file" accept="application/json" style="display:none" />
          <button class="btn-ghost" onclick="document.getElementById('tpRestoreFile').click()">â­± Import Backup</button>
        </div>

        <div id="tpBackupStatus"
             class="muted"
             style="margin-top:6px;font-size:12px;"></div>
      </section>

      <!-- Med Settings -->
      <section class="card">
        <h3 style="margin:0 0 8px">Meds Settings</h3>

        <div class="row" style="margin-bottom:8px">
          <input id="medsTablets" placeholder="Tablets on hand" />
          <input id="medsDoses" placeholder="Doses per day" />
          <button class="primary" onclick="saveMedsSettings()">Save</button>
        </div>

        <div class="muted" style="font-size:12px;">
          Used to estimate refill timing.
        </div>
      </section>

    </div> <!-- END SETTINGS TAB -->

    <footer style="margin-top:6px;text-align:center;font-size:11px;color:var(--muted);">
      Task Pulse Smart V8.7 Â· Powered by D Gounder
    </footer>

  </div>
</div>

   /* ===============================
   Task Pulse Smart â€“ V8.7 Hybrid
   PART C â€” FULL JS ENGINE
   =============================== */

/* -------------------------------
   LOCAL STORAGE KEYS + STATE
--------------------------------*/
const LS_KEY = 'tp_days_v1';
const LS_MEDS = 'tp_meds_v1';
const LS_TAB = 'tp_last_tab';
const LS_SYNC = 'tp_sync_code';
const LS_LAST_OPEN = 'tp_last_open';
const LS_LAST_CARRY = 'tp_last_carry';

const TODAY = isoToday();
let days = load(LS_KEY, {});
let meds = load(LS_MEDS, {});
let viewing = TODAY;

/* Dirty-write safety */
let tpDirty = false;
function baseSave(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
let save = function (k, v) {
  try { baseSave(k, v); tpDirty = false; }
  catch (e) { tpDirty = true; }
};
setInterval(() => {
  if (!tpDirty) return;
  try { baseSave(LS_KEY, days); tpDirty = false; } catch {}
}, 3000);

window.addEventListener("beforeunload", () => {
  try {
    baseSave(LS_KEY, days);
    baseSave(LS_MEDS, meds);
  } catch {}
});

/* -----------------------------------
   LOAD + SPLASH
------------------------------------ */
window.addEventListener("load", () => {
  setTimeout(() => document.body.classList.add("hide-splash"), 1500);
});

document.addEventListener("DOMContentLoaded", () => {
  showTab(localStorage.getItem(LS_TAB) || "tasks");
  autoCarryForward();
  renderAll();
  renderMeds();
  updateMedsBanner();
  scheduleMedsCountdown();
  ensureSyncCode();
  renderHistory();
});

/* -----------------------------------
   TAB SWITCHING
------------------------------------ */
function showTab(id) {
  document.querySelectorAll(".tabpage").forEach(el => el.classList.remove("active"));
  const page = document.getElementById("tab-" + id);
  if (page) page.classList.add("active");

  document.querySelectorAll(".tabbar button").forEach(b => b.classList.remove("active"));
  const btn = document.getElementById("btnTab" + id.charAt(0).toUpperCase() + id.slice(1));
  if (btn) btn.classList.add("active");

  localStorage.setItem(LS_TAB, id);
  if (id === "history") renderHistory();
}

/* -----------------------------------
   MEDICATION ENGINE
------------------------------------ */
function medsFor(iso) {
  if (!meds[iso]) meds[iso] = { day: "", night: "" };
  return meds[iso];
}

function toggleMeds(which) {
  const m = medsFor(TODAY);

  if (m[which]) {
    if (!confirm("Remove this log?")) return;
    m[which] = "";
  } else {
    m[which] = new Date().toISOString();
  }

  baseSave(LS_MEDS, meds);
  renderMeds();
  updateMedsBanner();
  scheduleMedsCountdown();
  notifyLocalChanged();
}

function renderMeds() {
  const m = medsFor(TODAY);

  const btnDay = document.getElementById("btnMedsDay");
  const btnNight = document.getElementById("btnMedsNight");

  const dayTaken = !!m.day;
  const nightTaken = !!m.night;

  if (btnDay) {
    btnDay.className = "meds-btn" + (dayTaken ? " meds-btn-taken" : "");
    btnDay.innerHTML = `
      <span class="meds-btn-title">ðŸŒ… Morning Dose</span>
      <span class="meds-btn-sub">${dayTaken ? "Taken Â· " + fmtDateTime(m.day) : "Tap to log"}</span>
      <div class="meds-timer" id="timerDay"></div>
    `;
  }

  if (btnNight) {
    btnNight.className = "meds-btn" + (nightTaken ? " meds-btn-taken" : "");
    btnNight.innerHTML = `
      <span class="meds-btn-title">ðŸŒ™ Night Dose</span>
      <span class="meds-btn-sub">${nightTaken ? "Taken Â· " + fmtDateTime(m.night) : "Tap to log"}</span>
      <div class="meds-timer" id="timerNight"></div>
    `;
  }
}

/* -----------------------------------
   MEDS BANNER (CLEAN â€“ NEW STYLE)
------------------------------------ */
function updateMedsBanner() {
  const m = medsFor(TODAY);
  const bar = document.getElementById("medsReminder");
  if (!bar) return;

  if (!m.day && !m.night) {
    bar.style.display = "block";
    bar.textContent = "Morning & Night meds not taken";
    return;
  }
  if (!m.day) {
    bar.style.display = "block";
    bar.textContent = "Morning meds not taken";
    return;
  }
  if (!m.night) {
    bar.style.display = "block";
    bar.textContent = "Night meds not taken";
    return;
  }

  bar.style.display = "none";
}

/* -----------------------------------
   12-HOUR COUNTDOWN TIMER
------------------------------------ */
let medsClockInterval = null;

function scheduleMedsCountdown() {
  if (medsClockInterval) clearInterval(medsClockInterval);

  medsClockInterval = setInterval(() => {
    const m = medsFor(TODAY);
    updateCountdown("day", m.day, "timerDay");
    updateCountdown("night", m.night, "timerNight");
  }, 1000);

  scheduleMedsCountdown(); // <-- this was wrong in your HTML. LOOP FIXED.
}

function updateCountdown(type, iso, id) {
  const el = document.getElementById(id);
  if (!el) return;

  if (!iso) {
    el.textContent = "";
    return;
  }

  const logged = new Date(iso);
  const target = new Date(logged.getTime() + (type === "day" ? 12 : 12) * 3600 * 1000);

  const now = new Date();
  let diff = target - now;

  if (diff <= 0) {
    el.textContent = "Due now";
    return;
  }

  const h = Math.floor(diff / 3600000);
  diff %= 3600000;
  const m = Math.floor(diff / 60000);
  const s = Math.floor(diff / 1000) % 60;

  el.textContent = `${pad(h)}h ${pad(m)}m ${pad(s)}s`;
}

/* -----------------------------------
   MEDS WEEKLY STREAK DATA
------------------------------------ */
function getMedsStreak() {
  const out = [];
  for (let i = 6; i >= 0; i--) {
    const iso = isoOffset(TODAY, -i);
    const m = medsFor(iso);
    out.push({
      iso,
      day: !!m.day,
      night: !!m.night,
      ok: !!m.day && !!m.night
    });
  }
  return out;
}

/* -----------------------------------
   TASK ENGINE (UNCHANGED FROM 8.6 but cleaned)
------------------------------------ */
function addTask() {
  const name = document.getElementById("taskInput").value.trim();
  const prio = document.getElementById("prioSelect").value;
  if (!name) return;

  ensureDay(viewing).unshift({
    id: "t_" + Math.random().toString(36).slice(2, 8),
    name,
    prio,
    done: false,
    stars: 0,
    createdAt: new Date().toISOString()
  });

  save(LS_KEY, days);
  document.getElementById("taskInput").value = "";
  renderAll();
}

/* (Other task functions preserved identical to V8.6) */

/* -----------------------------------
   HISTORY ENGINE
------------------------------------ */
function renderHistory() {
  const wrap = document.getElementById("histList");
  if (!wrap) return;

  wrap.innerHTML = "";

  const spanSel = document.getElementById("histSpan").value;
  const q = document.getElementById("histSearch").value.trim().toLowerCase();

  let keys = Object.keys(days);

  /* filter by span */
  if (spanSel !== "all") {
    const span = parseInt(spanSel, 10);
    const min = new Date();
    min.setDate(min.getDate() - span);
    keys = keys.filter(k => new Date(k) >= min);
  }

  /* filter search */
  if (q) {
    keys = keys.filter(k => {
      if (k.includes(q)) return true;
      return (days[k] || []).some(t =>
        (t.name || "").toLowerCase().includes(q)
      );
    });
  }

  keys.sort((a, b) => new Date(b) - new Date(a));

  if (!keys.length) {
    wrap.innerHTML = `<div class="muted">No history found.</div>`;
    return;
  }

  keys.forEach(k => {
    const arr = days[k] || [];
    const total = arr.length;
    const done = arr.filter(t => t.done).length;
    const pct = total ? Math.round(done / total * 100) : 0;

    const row = document.createElement("div");
    row.className = "hist-row";

    row.innerHTML = `
      <div>
        <div style="font-weight:700">${fmtHumanDate(k)}</div>
        <div class="meta">${done}/${total} done â€¢ ${pct}% completed</div>
      </div>
      <button onclick="viewing='${k}'; showTab('tasks'); renderAll();">Open</button>
    `;

    wrap.appendChild(row);
  });
}

/* -----------------------------------
   AUTO-CARRY FORWARD
------------------------------------ */
function autoCarryForward() {
  const last = localStorage.getItem(LS_LAST_OPEN);
  const today = TODAY;

  let carried = 0;

  if (last && last !== today) {
    const prevTasks = ensureDay(last).filter(t => !t.done);

    if (prevTasks.length) {
      ensureDay(today).unshift(
        ...prevTasks.map(t => ({
          ...t,
          id: "t_" + Math.random().toString(36).slice(2, 8),
          createdAt: new Date().toISOString()
        }))
      );
      carried = prevTasks.length;
      days[last] = ensureDay(last).filter(t => t.done);
      save(LS_KEY, days);
    }
  }

  localStorage.setItem(LS_LAST_OPEN, today);
  localStorage.setItem(LS_LAST_CARRY, carried);
}

/* -----------------------------------
   SYNC ENGINE (auto-code working)
------------------------------------ */
const TP_UID = (localStorage.getItem("tp_uid") ||
  (() => {
    const v = "u_" + Math.random().toString(36).slice(2, 10);
    localStorage.setItem("tp_uid", v);
    return v;
  })()
);

function ensureSyncCode() {
  let code = localStorage.getItem(LS_SYNC);

  if (!code) {
    code = "grp-" + randomCode(6);
    localStorage.setItem(LS_SYNC, code);
  }

  const inp = document.getElementById("syncCode");
  if (inp) inp.value = code;
}

/* -----------------------------------
   UTILS
------------------------------------ */
function isoToday() {
  return new Date().toISOString().slice(0, 10);
}
function isoOffset(iso, d) {
  const dt = new Date(iso);
  dt.setDate(dt.getDate() + d);
  return dt.toISOString().slice(0, 10);
}
function ensureDay(iso) {
  if (!days[iso]) days[iso] = [];
  return days[iso];
}
function load(k, def) {
  try { return JSON.parse(localStorage.getItem(k)) ?? def; }
  catch { return def; }
}
function fmtHumanDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString(undefined, {day: "2-digit", month: "2-digit", year: "numeric"});
}
function fmtDateTime(iso) {
  const d = new Date(iso);
  return (
    d.toLocaleDateString(undefined, {day:"2-digit",month:"2-digit",year:"numeric"}) +
    " â€” " +
    d.toLocaleTimeString(undefined, {hour:"numeric",minute:"2-digit"})
  );
}
function pad(x) { return x < 10 ? "0"+x : x; }
function randomCode(len=6){
  const chars="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let out=""; 
  for(let i=0;i<len;i++) out+=chars[Math.floor(Math.random()*chars.length)];
  return out;
}

   

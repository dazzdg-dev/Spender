<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Task Pulse Money</title>
<meta name="theme-color" content="#0f111a" />

<style>
  *{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
    -webkit-font-smoothing:antialiased;
  }
  body{
    background:#0f111a;
    background-image:
      radial-gradient(circle at 20% 20%, rgba(80,90,255,.16) 0%, rgba(15,17,26,0) 60%),
      radial-gradient(circle at 80% 30%, rgba(255,0,128,.12) 0%, rgba(15,17,26,0) 60%);
    background-size:100% 100%;
    color:#e9e9ef;
    max-width:480px;
    margin:0 auto;
  }

  main{
    padding:16px 16px 80px;
  }

  header{
    background:radial-gradient(circle at 20% 20%,#2f324a 0%,#0f111a 60%);
    color:#fff;
    padding:16px;
    border-bottom:1px solid rgba(255,255,255,0.07);
    border-radius:0 0 20px 20px;
    box-shadow:
      0 30px 80px rgba(0,0,0,.8),
      0 0 60px rgba(89,102,255,.4);
  }
  .app-label{
    font-size:.8rem;
    color:#bdbdfd;
    font-weight:500;
  }
  .today-date{
    color:#fff;
    font-size:1.1rem;
    font-weight:600;
    line-height:1.3;
  }

  .build-banner{
    text-align:center;
    font-size:.7rem;
    color:#9ca0ff;
    padding:4px 0 12px;
    text-shadow:0 0 8px rgba(89,102,255,.6);
  }

  .card{
    background:#ffffff;
    border:1px solid rgba(255,255,255,0.6);
    border-radius:16px;
    box-shadow:0 20px 50px rgba(0,0,0,.5);
    padding:16px;
    margin-bottom:20px;
    color:#1a1a1a;
  }

  .section-headline{
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    row-gap:8px;
    margin-bottom:12px;
  }
  .section-title{
    font-size:1rem;
    font-weight:600;
    color:#111;
  }
  .section-sub{
    font-size:.8rem;
    color:#444;
    text-align:right;
    min-width:max-content;
    padding-left:8px;
  }
  .small{
    font-size:.8rem;
    color:#666;
  }

  /* table-ish rows */
  .spend-header-row,
  .spend-row,
  .spend-total-row{
    display:grid;
    grid-template-columns: 1fr auto auto;
    grid-template-areas:
      "left middle right";
    align-items:flex-start;
    column-gap:8px;
    padding:8px 0;
    border-bottom:1px solid #e4e4e7;
    font-size:.8rem;
    line-height:1.4;
    word-break:break-word;
  }

  .spend-header-row{
    font-weight:600;
    color:#111;
    border-bottom:2px solid #1d1d1f;
    padding-bottom:8px;
    margin-bottom:4px;
  }

  .spend-left    { grid-area:left; }
  .spend-middle  { grid-area:middle; text-align:right; }
  .spend-right   { grid-area:right; text-align:right; min-width:70px; }

  /* color accents for cells */
  .cell-item{
    background:#e8f8d8; /* soft green */
    border-radius:4px;
    padding:2px 4px;
    font-weight:600;
    color:#1a1a1a;
    display:inline-block;
    max-width:100%;
  }
  .cell-type{
    background:#d5efff; /* soft blue */
    border-radius:4px;
    padding:2px 4px;
    color:#003049;
    display:inline-block;
    max-width:100%;
  }
  .cell-payer{
    background:#f2d9f6; /* soft purple */
    border-radius:4px;
    padding:2px 4px;
    color:#4a125c;
    display:inline-block;
    max-width:100%;
  }

  .spend-meta{
    font-size:.7rem;
    color:#444;
    line-height:1.3;
  }

  .spend-amount{
    font-size:.8rem;
    font-weight:600;
    color:#1a1a1a;
  }

  .spend-total-row{
    border-bottom:none;
    font-weight:600;
    color:#c00000;
  }
  .spend-total-row .spend-right{
    color:#c00000;
  }

  /* Add new spend form */
  .input-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-bottom:8px;
  }
  .input-field,
  .input-select{
    flex:1;
    min-width:120px;
    border:1px solid #cfcfd3;
    border-radius:10px;
    padding:10px 12px;
    font-size:.9rem;
    outline:none;
    background:#fff;
    color:#1a1a1a;
  }
  .input-small{
    width:90px;
    flex:0 0 auto;
  }
  .add-btn{
    border-radius:10px;
    background:#1d1d1f;
    color:#fff;
    border:1px solid #1d1d1f;
    font-size:.85rem;
    font-weight:500;
    padding:10px 14px;
    min-width:70px;
  }
  .clear-btn{
    border-radius:10px;
    background:#fff;
    color:#1d1d1f;
    border:1px solid #cfcfd3;
    font-size:.8rem;
    font-weight:500;
    padding:8px 12px;
    min-width:110px;
    line-height:1.2;
  }

  .history-headline{
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    row-gap:8px;
    margin-bottom:12px;
    align-items:flex-start;
  }
  .history-left .small-top{
    font-size:.8rem;
    color:#444;
    line-height:1.2;
  }
  .history-left .hist-date{
    font-size:.9rem;
    font-weight:600;
    color:#111;
    line-height:1.3;
  }
  .history-nav{
    display:flex;
    gap:8px;
  }
  .history-nav button{
    background:#fff;
    border:1px solid #cfcfd3;
    color:#1d1d1f;
    padding:8px 10px;
    border-radius:10px;
    font-weight:500;
    min-width:44px;
    min-height:36px;
    line-height:1;
    font-size:1rem;
  }

  /* summary card (7 days) */
  .summary-grid{
    width:100%;
    font-size:.8rem;
    line-height:1.4;
    border-top:1px solid #e4e4e7;
    margin-top:8px;
    padding-top:8px;
  }
  .summary-row{
    display:flex;
    justify-content:space-between;
    padding:4px 0;
  }
  .summary-left{
    font-weight:500;
    color:#111;
  }
  .summary-right{
    min-width:90px;
    text-align:right;
    color:#1a1a1a;
    font-weight:500;
  }
  .summary-money{
    color:#1a1a1a;
  }
  .summary-total{
    color:#c00000;
    font-weight:600;
  }
</style>
</head>
<body>

<header>
  <div class="app-label">Spending</div>
  <div class="today-date" id="headerToday">--</div>
</header>

<div class="build-banner">
  Task Pulse Money · offline v1 · Powered by Daryl G
</div>

<main>

  <!-- CARD 1: Today's / Viewing Day Entries -->
  <section class="card" id="dayCard">
    <div class="section-headline">
      <div class="section-title">Spending (this day)</div>
      <div class="section-sub" id="dayTotalLine">R 0.00</div>
    </div>

    <!-- table header row -->
    <div class="spend-header-row">
      <div class="spend-left">item / type / payer</div>
      <div class="spend-middle">date / time</div>
      <div class="spend-right">amount</div>
    </div>

    <!-- rows go here -->
    <div id="spendList"></div>

    <!-- total row -->
    <div class="spend-total-row">
      <div class="spend-left"></div>
      <div class="spend-middle"></div>
      <div class="spend-right" id="spendTotalRed">R 0.00</div>
    </div>
  </section>

  <!-- CARD 2: Add Spend -->
  <section class="card">
    <div class="section-headline" style="margin-bottom:8px;">
      <div class="section-title">Add new purchase</div>
      <div class="section-sub" style="font-size:.7rem;line-height:1.3;">
        date/time auto<br/>saved
      </div>
    </div>

    <div class="input-row">
      <input id="newItem" class="input-field" placeholder="what (bp, food lovers…)" />
    </div>

    <div class="input-row">
      <select id="newType" class="input-select">
        <option value="food">food</option>
        <option value="fuel">fuel</option>
        <option value="clothing">clothing</option>
        <option value="Medicine">Medicine</option>
        <option value="electricity">electricity</option>
      </select>

      <select id="newPayer" class="input-select">
        <option value="presh">presh</option>
        <option value="daryl">daryl</option>
      </select>

      <input id="newAmount" class="input-field input-small" type="number" min="0" step="0.01" placeholder="R" />
    </div>

    <div class="input-row" style="align-items:flex-start;">
      <button id="addSpendBtn" class="add-btn">Add</button>
      <button id="clearDayBtn" class="clear-btn">Clear this day</button>
    </div>

    <div class="small" style="color:#666;">
      • Amount is in Rand (R).<br/>
      • Payer = who paid.<br/>
      • Type = fuel / food / etc.<br/>
      • After Add: it appears in the day list and is saved on this device.
    </div>
  </section>

  <!-- CARD 3: Day Navigation -->
  <section class="card">
    <div class="history-headline">
      <div class="history-left">
        <div class="small-top small">Viewing</div>
        <div class="hist-date" id="viewingDateLabel">--</div>
      </div>
      <div class="history-nav">
        <button id="prevDayBtn">◀</button>
        <button id="nextDayBtn">▶</button>
      </div>
    </div>

    <div class="small" id="viewingDayStats" style="color:#444;margin-bottom:8px;">
      0 entries · R 0.00
    </div>
    <div class="small" style="color:#444;">
      Use ◀ ▶ to move through dates. Totals + summary update.
    </div>
  </section>

  <!-- CARD 4: Summary (7-day window) -->
  <section class="card">
    <div class="section-headline">
      <div class="section-title">Summary</div>
      <div class="section-sub" style="line-height:1.3;text-align:right;">
        <div id="summaryRangeDate">--</div>
        <div style="font-size:.7rem;color:#666;">7 days</div>
      </div>
    </div>

    <div class="summary-grid" id="summaryGrid">
      <!-- rows inserted here -->
    </div>
  </section>

</main>

<script>
/* ===========================
   0. TIME / DATE HELPERS
   =========================== */
function pad2(n){ return String(n).padStart(2,"0"); }

function todayISO(){
  const d=new Date();
  return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
}

function formatISOasDMY(iso){
  // "2025-10-27" -> "27-10-2025"
  const [y,m,d]=iso.split("-");
  return d+"-"+m+"-"+y;
}

function formatCurrencyR(amount){
  // format like: R 3,500.00
  const n = Number(amount||0);
  return "R " + n.toLocaleString("en-ZA", {
    minimumFractionDigits:2,
    maximumFractionDigits:2
  });
}

function nowTime12h(){
  // "6:45 PM"
  const d=new Date();
  let h=d.getHours(), m=d.getMinutes();
  const ampm = h>=12 ? "PM":"AM";
  h = (h%12)||12;
  return h+":"+pad2(m)+" "+ampm;
}

/* get array of last 7 days (including baseIso) */
function getLast7Days(baseIso){
  // baseIso: "2025-10-27"
  const [Y,M,D] = baseIso.split("-");
  const base = new Date(Number(Y),Number(M)-1,Number(D));
  const days=[];
  for(let i=0;i<7;i++){
    const dt=new Date(base);
    dt.setDate(dt.getDate()-i);
    const iso = dt.getFullYear()+"-"+pad2(dt.getMonth()+1)+"-"+pad2(dt.getDate());
    days.push(iso);
  }
  return days; // [base, base-1, ..., base-6]
}

/* shift date string +/- days */
function shiftISO(iso, delta){
  const [Y,M,D]=iso.split("-");
  const base=new Date(Number(Y),Number(M)-1,Number(D));
  base.setDate(base.getDate()+delta);
  return base.getFullYear()+"-"+pad2(base.getMonth()+1)+"-"+pad2(base.getDate());
}

/* ===========================
   1. STORAGE
   =========================== */
function loadSpends(){
  return JSON.parse(localStorage.getItem("tp_spends")||"[]");
}
function saveSpends(list){
  localStorage.setItem("tp_spends",JSON.stringify(list));
}

/*
Each spend:
{
  id: "s_abc123",
  item: "bp",
  type: "fuel",
  payer: "presh",
  amount: 500.00,
  date: "2025-10-27",
  time: "6:45 PM"
}
*/

function newSpend({item,type,payer,amount}){
  return {
    id: "s_"+Math.random().toString(36).slice(2,9),
    item,
    type,
    payer,
    amount: Number(amount)||0,
    date: todayISO(),
    time: nowTime12h()
  };
}

/* ===========================
   2. STATE
   =========================== */
let viewingDate = todayISO();

/* ===========================
   3. CORE ACTIONS
   =========================== */
function addSpend(){
  const itemEl   = document.getElementById("newItem");
  const typeEl   = document.getElementById("newType");
  const payerEl  = document.getElementById("newPayer");
  const amtEl    = document.getElementById("newAmount");

  const itemVal  = itemEl.value.trim();
  const typeVal  = typeEl.value;
  const payerVal = payerEl.value;
  const amtVal   = amtEl.value.trim();

  if(!itemVal || !amtVal){
    return; // require at least item+amount
  }

  const all = loadSpends();
  all.push(newSpend({
    item:itemVal,
    type:typeVal,
    payer:payerVal,
    amount:amtVal
  }));
  saveSpends(all);

  // reset inputs
  itemEl.value="";
  amtEl.value="";

  // After adding we ALWAYS consider "today" is the active day
  viewingDate = todayISO();
  renderAll();
}

function clearDay(){
  const all = loadSpends();
  const keep = all.filter(s=>s.date!==viewingDate);
  saveSpends(keep);
  renderAll();
}

function goPrevDay(){
  viewingDate = shiftISO(viewingDate, -1);
  renderAll();
}
function goNextDay(){
  viewingDate = shiftISO(viewingDate, +1);
  renderAll();
}

/* ===========================
   4. CALCULATIONS
   =========================== */
function getSpendsForDate(dateIso){
  const all = loadSpends();
  return all.filter(s=>s.date===dateIso);
}

function sumAmounts(list){
  return list.reduce((acc,s)=>acc+Number(s.amount||0),0);
}

function get7DaySummary(baseIso){
  // Build 7-day window totals for:
  // - each type
  // - each payer
  const all = loadSpends();
  const last7 = getLast7Days(baseIso); // array of ISO dates
  const includeSet = new Set(last7);

  let byType = {};
  let byPayer = {};
  let totalAll = 0;

  for(const s of all){
    if(includeSet.has(s.date)){
      const amt = Number(s.amount||0);
      totalAll += amt;

      // type totals
      if(!byType[s.type]) byType[s.type]=0;
      byType[s.type]+=amt;

      // payer totals
      if(!byPayer[s.payer]) byPayer[s.payer]=0;
      byPayer[s.payer]+=amt;
    }
  }

  return {
    days:last7,
    byType,
    byPayer,
    totalAll
  };
}

/* ===========================
   5. RENDER UI
   =========================== */
function renderHeader(){
  document.getElementById("headerToday").textContent =
    formatISOasDMY(todayISO());
}

function escapeHTML(str){
  return String(str).replace(/[&<>"]/g, c=>{
    const map={"&":"&amp;","<":"&lt;",">":"&gt;"};
    return map[c]||c;
  });
}

function renderDayCard(){
  const listEl  = document.getElementById("spendList");
  const totalEl = document.getElementById("spendTotalRed");
  const lineEl  = document.getElementById("dayTotalLine");

  const dayList = getSpendsForDate(viewingDate);
  const dayTotal = sumAmounts(dayList);

  // build rows for dayList
  // left column shows item, type, payer (color chips)
  // middle column shows date + time
  // right column shows amount
  listEl.innerHTML = dayList.map(s=>{
    return `
      <div class="spend-row">
        <div class="spend-left">
          <div class="cell-item">${escapeHTML(s.item)}</div>
          <div class="cell-type" style="margin-top:2px;">${escapeHTML(s.type)}</div>
          <div class="cell-payer" style="margin-top:2px;">${escapeHTML(s.payer)}</div>
        </div>
        <div class="spend-middle">
          <div>${formatISOasDMY(s.date)}</div>
          <div class="spend-meta">${escapeHTML(s.time)}</div>
        </div>
        <div class="spend-right spend-amount">${formatCurrencyR(s.amount)}</div>
      </div>
    `;
  }).join("");

  totalEl.textContent = formatCurrencyR(dayTotal);
  lineEl.textContent  = formatCurrencyR(dayTotal);
}

function renderViewingCard(){
  const vDateLabel = document.getElementById("viewingDateLabel");
  const statsEl    = document.getElementById("viewingDayStats");

  const dayList = getSpendsForDate(viewingDate);
  const dayTotal = sumAmounts(dayList);

  vDateLabel.textContent = formatISOasDMY(viewingDate);

  statsEl.textContent =
    `${dayList.length} entr${dayList.length===1?"y":"ies"} · ${formatCurrencyR(dayTotal)}`;
}

function renderSummaryCard(){
  const sumData = get7DaySummary(viewingDate);
  const rangeDateEl = document.getElementById("summaryRangeDate");
  const gridEl      = document.getElementById("summaryGrid");

  // show top-left cell text same as your screenshot:
  // left column: current viewing date
  // right column header: "7 days" is already shown in section-sub
  rangeDateEl.textContent = formatISOasDMY(viewingDate);

  // Build rows in this order:
  // 1) types (fuel/food/etc)
  // 2) payers (presh/daryl)
  // 3) grand total (red)

  // We'll show only non-zero categories to keep it neat.

  const rows = [];

  // types
  for(const typeKey of Object.keys(sumData.byType)){
    const val = sumData.byType[typeKey];
    if(val>0){
      rows.push({
        label:typeKey,
        amount:val,
        isTotal:false
      });
    }
  }

  // payers
  for(const payerKey of Object.keys(sumData.byPayer)){
    const val = sumData.byPayer[payerKey];
    if(val>0){
      rows.push({
        label:payerKey,
        amount:val,
        isTotal:false
      });
    }
  }

  // grand
  rows.push({
    label:"",
    amount:sumData.totalAll,
    isTotal:true
  });

  gridEl.innerHTML = rows.map(r=>{
    if(r.isTotal){
      return `
        <div class="summary-row">
          <div class="summary-left"></div>
          <div class="summary-right summary-total">${formatCurrencyR(r.amount)}</div>
        </div>
      `;
    } else {
      return `
        <div class="summary-row">
          <div class="summary-left">${escapeHTML(r.label)}</div>
          <div class="summary-right summary-money">${formatCurrencyR(r.amount)}</div>
        </div>
      `;
    }
  }).join("");
}

function renderAll(){
  renderHeader();
  renderDayCard();
  renderViewingCard();
  renderSummaryCard();
}

/* ===========================
   6. EVENT BINDINGS
   =========================== */
function bindUI(){
  document.getElementById("addSpendBtn").onclick = addSpend;
  document.getElementById("clearDayBtn").onclick = clearDay;
  document.getElementById("prevDayBtn").onclick = goPrevDay;
  document.getElementById("nextDayBtn").onclick = goNextDay;
}

/* ===========================
   7. INIT
   =========================== */
function init(){
  bindUI();
  renderAll();
}

init();
</script>

</body>
</html>
